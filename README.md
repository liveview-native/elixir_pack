# Elixir Pack

Build your Elixir application for iOS with the following mix task:

```sh
mix elixir_pack TestPackage --target iphonesimulator-arm64
```

## Offline LiveView Native Apps
Elixir Pack can build Phoenix applications to run on-device for offline support.

### Add dependencies
Add `elixir_pack` as a dev dependency in your `mix.exs` file.

```elixir
def deps do
  [
    {:elixir_pack, git: "https://github.com/liveview-native/elixir_pack", branch: "main"}
  ]
end
```

> [!WARNING]
> `plug_crypto` is currently [incompatible with iOS](https://github.com/elixir-plug/plug_crypto/pull/44).
> Override the dependency in your mix file with the following fork as a workaround:
> ```elixir
> def deps do
>   [
>     {:plug_crypto, git: "https://github.com/diodechain/plug_crypto", branch: "main", override: true}
>   ]
> end
> ```


### Prepare for a production release
Elixir Pack will run `mix release` to compile your application.
If making a production build, make sure to prepare the static files.
```sh
mix phx.digest
```

### Run Elixir Pack
Run the `elixir_pack` mix task to create a Swift Package containing your Phoenix server and OTP for iOS.

```sh
MIX_ENV=prod mix elixir_pack native/swiftui/YourAppServer --target iphonesimulator-arm64 --target iphoneos
```

Run `mix help elixir_pack` to get more info on the supported options.

### Add server to Xcode project
Open your Xcode project and add the server package as a dependency.

  1. Go to *File* -> *Add Package Dependencies...*
  2. Click the *Add Local...* button in the bottom left of the popup
  3. Select the server package generated by Elixir Pack (such as *native/swiftui/YourAppServer*)
  4. In the *Add to Target* dropdown, select your app's target

### Setup server launch
Import the generated package, and modify your `App` struct to start the server on launch.

```swift
import YourAppServer

struct YourApp: App {
  init() {
    YourAppServer.start()
  }

  var body: some Scene {
    // ...
  }
}
```

You can optionally pass a `host`, `port`, and `secretKeyBase` to configure the server on startup.

### Connect `LiveView` to the local server
Ensure your `LiveView` connects to the correct host and port.

```swift
struct ContentView: View {
  var body: some View {
    #LiveView(.localhost) // `.localhost` uses the default host and port
  }
}
```

### Run the application
When you run the application, the server will start on a separate thread and the client will connect.
Any logs from the server will appear in Xcode's debugger log.

## Installation

If [available in Hex](https://hex.pm/docs/publish), the package can be installed
by adding `elixir_pack` to your list of dependencies in `mix.exs`:

```elixir
def deps do
  [
    {:elixir_pack, "~> 0.1.0"}
  ]
end
```

Documentation can be generated with [ExDoc](https://github.com/elixir-lang/ex_doc)
and published on [HexDocs](https://hexdocs.pm). Once published, the docs can
be found at <https://hexdocs.pm/elixir_pack>.

